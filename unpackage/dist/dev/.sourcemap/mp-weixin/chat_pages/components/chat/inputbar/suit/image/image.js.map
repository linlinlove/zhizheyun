{"version":3,"sources":["webpack:///E:/uniapp/zhizheyun/zhizheyun/zhizheyun(1)/chat_pages/components/chat/inputbar/suit/image/image.vue?0f0b","webpack:///E:/uniapp/zhizheyun/zhizheyun/zhizheyun(1)/chat_pages/components/chat/inputbar/suit/image/image.vue?3770","webpack:///E:/uniapp/zhizheyun/zhizheyun/zhizheyun(1)/chat_pages/components/chat/inputbar/suit/image/image.vue?9792","webpack:///E:/uniapp/zhizheyun/zhizheyun/zhizheyun(1)/chat_pages/components/chat/inputbar/suit/image/image.vue?7f6c","uni-app:///chat_pages/components/chat/inputbar/suit/image/image.vue"],"names":["data","components","props","username","type","default","chatType","methods","openCamera","uni","count","sizeType","sourceType","success","me","sendImage","console","isGroupChat","getSendToParam","upLoadImage","src","jpg","jpeg","gif","png","bmp","title","icon","url","filePath","fileType","name","header","Authorization","duration","size","width","height","filetype","filename","msg","apiUrl","body","from","to","roomType","disp","WebIM","fail","complete","saveSendMsg","msgStorage"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;;;AAGpD;AACgL;AAChL,gBAAgB,yLAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAspB,CAAgB,2qBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;ACI1qB;AACA;AACA;AACA;AAAA,gBACA;EACAA;IACA;EACA;EAEAC;EACAC;IACAC;MACAC;MACAC;QAAA;MAAA;IACA;IACAC;MACAF;MACAC;IACA;EACA;EACAE;IACAC;MACA;MACAC;QACAC;QACAC;QACAC;QAEAC;UACAC;QACA;MAEA;IACA;IAEAC;MACA;MACAN;QACAC;QACAC;QACAC;QAEAC;UACAG;UACAF;QACA;MAEA;IACA;IAEAG;MACA;IACA;IAEAC;MACA;IACA;IAEAC;MACA;MACA;MACA;MACAV;QACAW;QAEAP;UACA;YACAQ;YACAC;YACAC;YACAC;YACAC;UACA;UACA;UACA;UACA;UACA;UACAT;UACA;UACA;YACAP;cACAiB;cACAC;YACA;UACA;UACA;YACAlB;cACAmB;cACAC;cACAC;cACAC;cACAC;gBACA;gBACA;gBACAC;cACA;cACApB;gBACAG;gBACA;kBACA;kBACA;kBACA;kBACAP;oBACAiB;oBACAQ;kBACA;kBACA;kBACA;gBACA;;gBACA;gBACA;gBACA;;gBAEA;gBACA;kBACA9B;kBACA+B;oBACAC;oBACAC;kBACA;kBACAT;kBACAU;kBACAC;gBACA;gBACAC;kBACAC;kBACAC;kBACAC;kBACAC;kBACAC;kBACAvC;kBACAO;oBACAiC;kBACA;gBACA;gBAEA;kBACAN;gBACA;gBAEAO;gBACA;kBACAP;kBACApC;gBACA;gBACAU;cACA;cACAkC;gBACAhC;cACA;cACAiC;gBACAjC;cACA;YACA;UACA;QACA;MACA;IACA;IACAkC;MACAC;IACA;EAEA;AACA;AAAA,4B","file":"chat_pages/components/chat/inputbar/suit/image/image.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./image.vue?vue&type=template&id=02b232ae&\"\nvar renderjs\nimport script from \"./image.vue?vue&type=script&lang=js&\"\nexport * from \"./image.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"chat_pages/components/chat/inputbar/suit/image/image.vue\"\nexport default component.exports","export * from \"-!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./image.vue?vue&type=template&id=02b232ae&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./image.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./image.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view></view>\r\n</template>\r\n<script>\r\n\tlet WebIM = require(\"@/utils/WebIM\")[\"default\"];\r\n\tlet msgType = require(\"../../../msgtype\");\r\n\tlet disp = require(\"@/utils/broadcast\");\r\n\tlet msgStorage = require(\"../../../msgstorage\");\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {};\r\n\t\t},\r\n\r\n\t\tcomponents: {},\r\n\t\tprops: {\r\n\t\t\tusername: {\r\n\t\t\t\ttype: Object,\r\n\t\t\t\tdefault: () => ({})\r\n\t\t\t},\r\n\t\t\tchatType: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: msgType.chatType.SINGLE_CHAT\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\topenCamera() {\r\n\t\t\t\tvar me = this;\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tcount: 1,\r\n\t\t\t\t\tsizeType: [\"original\", \"compressed\"],\r\n\t\t\t\t\tsourceType: [\"camera\"],\r\n\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tme.upLoadImage(res);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tsendImage() {\r\n\t\t\t\tvar me = this;\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tcount: 1,\r\n\t\t\t\t\tsizeType: [\"original\", \"compressed\"],\r\n\t\t\t\t\tsourceType: [\"album\"],\r\n\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tconsole.log('选择的图片', res)\r\n\t\t\t\t\t\tme.upLoadImage(res);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tisGroupChat() {\r\n\t\t\t\treturn this.chatType == msgType.chatType.CHAT_ROOM;\r\n\t\t\t},\r\n\r\n\t\t\tgetSendToParam() {\r\n\t\t\t\treturn this.isGroupChat() ? this.username.groupId : this.username.your;\r\n\t\t\t},\r\n\r\n\t\t\tupLoadImage(res) {\r\n\t\t\t\tvar me = this;\r\n\t\t\t\tvar tempFilePaths = res.tempFilePaths;\r\n\t\t\t\tvar token = WebIM.conn.context.accessToken;\r\n\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\tsrc: res.tempFilePaths[0],\r\n\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tvar allowType = {\r\n\t\t\t\t\t\t\tjpg: true,\r\n\t\t\t\t\t\t\tjpeg: true,\r\n\t\t\t\t\t\t\tgif: true,\r\n\t\t\t\t\t\t\tpng: true,\r\n\t\t\t\t\t\t\tbmp: true\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tvar str = WebIM.config.appkey.split(\"#\");\r\n\t\t\t\t\t\tvar width = res.width;\r\n\t\t\t\t\t\tvar height = res.height;\r\n\t\t\t\t\t\tvar index = res.path.lastIndexOf(\".\");\r\n\t\t\t\t\t\tconsole.log('index>>',index);\r\n\t\t\t\t\t\tvar filetype = ~index && res.path.slice(index + 1) || \"\";\r\n\t\t\t\t\t\tif (!res.type) {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: \"H5端，uni-app暂未支持\",\r\n                      \t\t\ticon: \"none\"\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (filetype.toLowerCase() in allowType || res.type in allowType) {\r\n\t\t\t\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\t\t\t\turl: \"https://a1.easemob.com/\" + str[0] + \"/\" + str[1] + \"/chatfiles\",\r\n\t\t\t\t\t\t\t\tfilePath: tempFilePaths[0],\r\n\t\t\t\t\t\t\t\tfileType: 'image',\r\n\t\t\t\t\t\t\t\tname: \"file\",\r\n\t\t\t\t\t\t\t\theader: {\r\n\t\t\t\t\t\t\t\t\t// \"Content-Type\": \"multipart/form-data\",\r\n\t\t\t\t\t\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\r\n\t\t\t\t\t\t\t\t\tAuthorization: \"Bearer \" + token\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tsuccess: (res)=>{\r\n\t\t\t\t\t\t\t\t\tconsole.log('上传图片成功', res)\r\n\t\t\t\t\t\t\t\t\tif (res.statusCode == 400) {\r\n\t\t\t\t\t\t\t\t\t\t// 图片上传阿里云检验不合法\r\n\t\t\t\t\t\t\t\t\t\t// var errData = JSON.parse(res.data);\r\n\t\t\t\t\t\t\t\t\t\t// if (errData.error === 'content improper') {\r\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: \"图片检测不合法\",\r\n\t\t\t\t\t\t\t\t\t\t\tduration: 1000\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\treturn false\r\n\t\t\t\t\t\t\t\t\t\t// }\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tvar data = res.data;\r\n\t\t\t\t\t\t\t\t\tvar dataObj = JSON.parse(data);\r\n\t\t\t\t\t\t\t\t\tvar id = WebIM.conn.getUniqueId(); // 生成本地消息 id\r\n\r\n\t\t\t\t\t\t\t\t\tvar msg = new WebIM.message(msgType.IMAGE, id);\r\n\t\t\t\t\t\t\t\t\tvar file = {\r\n\t\t\t\t\t\t\t\t\t\ttype: msgType.IMAGE,\r\n\t\t\t\t\t\t\t\t\t\tsize: {\r\n\t\t\t\t\t\t\t\t\t\t\twidth: width,\r\n\t\t\t\t\t\t\t\t\t\t\theight: height\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\turl: dataObj.uri + \"/\" + dataObj.entities[0].uuid,\r\n\t\t\t\t\t\t\t\t\t\tfiletype: filetype,\r\n\t\t\t\t\t\t\t\t\t\tfilename: tempFilePaths[0]\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\tmsg.set({\r\n\t\t\t\t\t\t\t\t\t\tapiUrl: WebIM.config.apiURL,\r\n\t\t\t\t\t\t\t\t\t\tbody: file,\r\n\t\t\t\t\t\t\t\t\t\tfrom: me.username.myName,\r\n\t\t\t\t\t\t\t\t\t\tto: me.getSendToParam(),\r\n\t\t\t\t\t\t\t\t\t\troomType: false,\r\n\t\t\t\t\t\t\t\t\t\tchatType: me.chatType,\r\n\t\t\t\t\t\t\t\t\t\tsuccess: function(argument) {\r\n\t\t\t\t\t\t\t\t\t\t\tdisp.fire('em.chat.sendSuccess', id);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\tif (me.chatType == msgType.chatType.CHAT_ROOM) {\r\n\t\t\t\t\t\t\t\t\t\tmsg.setGroup(\"groupchat\");\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tWebIM.conn.send(msg.body);\r\n\t\t\t\t\t\t\t\t\tlet obj = {\r\n\t\t\t\t\t\t\t\t\t\tmsg: msg,\r\n\t\t\t\t\t\t\t\t\t\ttype: msgType.IMAGE\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tme.saveSendMsg(obj);\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\t\tconsole.log('上传失败', err)\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tcomplete: (err) => {\r\n\t\t\t\t\t\t\t\t\tconsole.log('上传完成', err)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tsaveSendMsg(evt) {\r\n\t\t\t\tmsgStorage.saveMsg(evt.msg, evt.type);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t};\r\n</script>\r\n"],"sourceRoot":""}