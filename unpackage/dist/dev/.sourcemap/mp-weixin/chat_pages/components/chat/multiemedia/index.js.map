{"version":3,"sources":["webpack:///E:/uniapp/zhizheyun/zhizheyun/zhizheyun(1)/chat_pages/components/chat/multiemedia/index.nvue?3cdb","webpack:///E:/uniapp/zhizheyun/zhizheyun/zhizheyun(1)/chat_pages/components/chat/multiemedia/index.nvue?73fd","webpack:///E:/uniapp/zhizheyun/zhizheyun/zhizheyun(1)/chat_pages/components/chat/multiemedia/index.nvue?e2bc","webpack:///E:/uniapp/zhizheyun/zhizheyun/zhizheyun(1)/chat_pages/components/chat/multiemedia/index.nvue?fabb","uni-app:///chat_pages/components/chat/multiemedia/index.nvue"],"names":["data","pubUrl","subUrls","showInvite","devicePosition","muted","playVideoMuted","devicePositionIcon","devicePositionColor","micphoneIcon","beautyIcon","micphoneColor","videoIcon","videoColor","beauty","beautyColor","myName","confrId","enableCamera","time","context","props","username","type","default","action","groupId","methods","joinRoom","console","me","roomName","password","role","config","rec","recMerge","params","wx","setTimeout","finally","createConf","joinConf","togglePlay","toggleCamera","success","toggleMuted","toggleBeauty","hangup","inviteMember","netstatusChange","getTimer","count","stopTimer","clearInterval","error","statechange","mounted","keepScreenOn","streamId","subUrl","memName","obj"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAmH;AACnH;AAC0D;AACL;;;AAGrD;AACgL;AAChL,gBAAgB,yLAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,iFAAM;AACR,EAAE,0FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,qFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAAupB,CAAgB,4qBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;gBCmE3qB;EACAA;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MAEAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACAC;MACAC;MACAC;QAAA;MAAA;IACA;IACAC;MACAF;MACAC;IACA;IACAE;MACAH;MACAC;IACA;EACA;EACAG;IACAC;MACA;MACAC;MACAC;MACAD;MACA;MACA;QACAT;MACA;MACA;MACA;MACA;MACA;MACA;QACAW;QACAC;QACAC;QACAC;UACAC;UACAC;QACA;MACA;MACA;QACAC;QACAA;MACA;MAEAC;QACAT;QACA;QACAC;UACAb;QACA;QACAa;UAAAb;UAAAS;UAAAK;UAAAC;QAAA;QAEAH;QACA;QACAA;QACAS;UACAT;UACAA;UACAC;YACA7B;UACA;UACAsC;YACAV;YACAA;YACAC;UACA;QACA;UACAD;UACA;QACA,GACAW;UACAX;QACA;;QACAA;MACA;IAGA;IACAY;MACAZ;MAEA;MACA;MACA;MACA;MACAS;QACAT;QACA;QACA;QACA;QAEAS;UACAT;QACA;QACA;QACA;QACA;;QAEAC;UACAb;QACA;QACAa;UAAAb;UAAAS;QAAA;MACA;IACA;IAEAgB;MACAb;MACAA;MACA;MACAS;QACAT;QACA;QACA;QACAS;UACAT;QACA;QACAC;UACAb;QACA;QACAa;UAAAb;UAAAS;QAAA;MACA;IACA;IAEAiB;MAAA;MACA;MACAd;;MAEA;MACA;QACAX;QACAjB;QACAW;QACAC;MACA;QACA;MACA;IACA;IAEA+B;MACAf;MACA;MACA;MACAC;QACAe;UACAf;YACA1B;YACAG;YACAC;UACA;YACA;UAAA,CACA;QACA;MACA;IAEA;IAEAsC;MACAjB;MACA;QACAxB;QACAI;QACAE;MACA;IACA;IAEAoC;MACA;QACAjC;QACAC;QACAL;MACA;IACA;IAEAsC;MACAnB;MACAS;MACA;MACA;IACA;IACAW;MACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACAC;MACArB;IACA;IAEAsB;MAAA;MACA;MACA;MACA;QACAC;QACA;QACA;QACA;QACAjC;QACA;UACAA;QACA;MACA;MAEA;QACA;UACA;QACA;QACA;MACA;IAEA;IACAkC;MACAC;IACA;IACAC;MACA1B;IACA;IACA2B;MACA3B;IACA;EACA;EAEA4B;IACA5B;IACAS;MACAoB;IACA;IACA7B;IACA;MACAb;IACA;IACAa;IACA;IACA;IACA;IACA;IACAA;IACA;IACAA;IACA;MACAA;MACA;MACA;;MAEA;MACA;MACA;QACAA;QACA;MACA;QACAA;QACA;MACA;IACA;MACA;MACA;MACA;MACA;IACA;;IACAS;MACAT;IACA;IACAS;MACAT;IACA;IACAS;MACAT;IACA;IAEAS;MACAT;IACA;IAEAS;MACAT;IACA;IAEAS;MACA;;MAEA;MACApC;;MAEA;;MAEA;MACA4B;QACA5B;QACAC;QACAC;QACAC;QACAC;QAGAG;QACAE;QACAC;QACAF;QACAG;QACAC;QACAC;QACAG;MACA;IACA;IAEAoB;MACAT;MACA;MACA;MACA;MACA;MACA;QACA;QACAS;UACAR;YACA7B;UACA;QACA;QAEA;QACA4B;;QAEA;QACA;QACAC;UACAZ;UACAjB;QACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACAiB;YAAAA;UAAA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;QACA;MACA;IACA;;IACAoB;MACAT;MACA;MACA;MACA;QACA;MACA;MACAS;QACAT;QACA;QACA;UACA8B;UACAC;UACAC;UACA;QACA;;QACA3D;QACA2B;QACAA;QAEAC;UACA5B;UACAC;QACA;MACA;MACA;IAEA;;IACAmC;MACAT;MACA3B;QACA;UACA;QACA;UACA2B;UACAA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;QACA;MACA;;MACAiC;MACAhC;QACA5B;MACA;MACA2B;IACA,GACAS;MACAT;IACA;EAEA;AAEA;AAAA,4B","file":"chat_pages/components/chat/multiemedia/index.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./index.nvue?vue&type=template&id=7754fd36&\"\nvar renderjs\nimport script from \"./index.nvue?vue&type=script&lang=js&\"\nexport * from \"./index.nvue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"chat_pages/components/chat/multiemedia/index.nvue\"\nexport default component.exports","export * from \"-!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.nvue?vue&type=template&id=7754fd36&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.subUrls.length\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.nvue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.nvue?vue&type=script&lang=js&\"","<template>\n\t<view class=\"wraper\">\n\t\t<view class=\"infoConnecting\">\n\t\t\t11多人会议\n\t\t</view>\n\t\t<live-pusher class=\"live-pusher\" :url=\"pubUrl\" @netstatus=\"netstatusChange\" :muted=\"false\" :enable-camera=\"true\" id=\"livePusher\"\n\t\t ref=\"livePusher\" @statechange=\"statechange\" mode=\"HD\" @error=\"error\"></live-pusher>\n\t\t</live-pusher>\n\t\n\t\t\t<view  \n\t\t\t\tv-if=\"subUrls.length > 0\"\n\t\t\t\tv-for=\"item in subUrls\">\n\t\n\t\t\t\t<video\n\t\t\t\t\t:id=\"item.streamId\"\n\t\t\t\t\t:src=\"item.subUrl\" \n\t\t\t\t\tobject-fit=\"contain\"\n\t\t\t\t\tautoplay \n\t\t\t\t>\n\t\t\t\t\t<view class=\"userName\">{{item.memName}}</view>\n\t\t\t\t</video>\n\t\n\t\t\t</view>\n\t\t<!-- </scroll-view> -->\n\t\n\t\n\t\t<!-- <view class=\"controlContent\">\n\t\t\t<view class=\"emediaContrContent\">\n\t\t\t\t<view class=\"controlItem\" @tap=\"toggleCamera\" style=\"{color: devicePositionColor}\">\n\t\t\t\t\t<image\n\t\t\t\t\t\tclass=\"icon-record\"\n\t\t\t\t\t\t:src=\"'../../../static/images/'+devicePositionIcon+'2x.png'\" style=\"{width:'22px'; height: '24px'}\"/>\n\t\t\t\t\t切换摄像头\n\t\t\t\t</view>\n\t\t\t\t<view class=\"controlItem\" @tap=\"toggleMuted\" style=\"{color: micphoneColor}\">\n\t\t\t\t\t<image\n\t\t\t\t\t\tclass=\"icon-record\"\n\t\t\t\t\t\t:src=\"'../../../static/images/'+micphoneIcon+'2x.png'\" style=\"{width:'22px'; height: '24px'}\"/>\n\t\t\t\t\t麦克风</view>\n\t\t\t\t<view class=\"controlItem\" @tap=\"togglePlay\" style=\"{color: videoColor}\">\n\t\t\t\t\t<image\n\t\t\t\t\t\tclass=\"icon-record\"\n\t\t\t\t\t\t:src=\"'../../../static/images/'+videoIcon+'2x.png'\" style=\"{width:'22px'; height: '24px'}\"/>\n\t\t\t\t\t视频</view>\n\t\t\t\t<view class=\"controlItem\" @tap=\"toggleBeauty\" style=\"{color: beautyColor}\">\n\t\t\t\t\t<image\n\t\t\t\t\t\tclass=\"icon-record\"\n\t\t\t\t\t\t:src=\"'../../../static/images/'+beautyIcon+'.png'\" style=\"{width:'16px'; height: '24px'}\"/>\n\t\t\t\t\t美颜</view>\n\t\t\t\t<view class=\"controlItem\" @tap=\"inviteMember\">\n\t\t\t\t\t<image\n\t\t\t\t\t\tclass=\"icon-record\"\n\t\t\t\t\t\tsrc='../../../static/images/invite_white2x.png' style=\"{width:'22px'; height: '24px'\"/>\n\t\t\t\t\t邀请</view>\n\t\t\t</view>\n\t\n\t\t\t<view class=\"hangup\" @tap=\"hangup\">\n\t\t\t\t<image\n\t\t\t\t\tclass=\"icon-record\"\n\t\t\t\t\tsrc='../../../static/images/hangup2x.png'/>\n\t\t\t</view>\n\t\t</view>\n\t -->\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tpubUrl: \"\",\n\t\t\t\tsubUrls: [],\n\t\t\t\tshowInvite: true,\n\t\t\t\tdevicePosition: \"front\",\n\t\t\t\tmuted: false,\n\t\t\t\tplayVideoMuted: false,\n\t\t\n\t\t\t\tdevicePositionIcon: 'switchCamera_white',\n\t\t\t\tdevicePositionColor: '#fff',\n\t\t\t\tmicphoneIcon: 'micphone_white',\n\t\t\t\tbeautyIcon: 'beauty',\n\t\t\t\tmicphoneColor: '#fff',\n\t\t\t\tvideoIcon: 'video_white',\n\t\t\t\tvideoColor: '#fff',\n\t\t\t\tbeauty: 9,\n\t\t\t\tbeautyColor: '#fff',\n\t\t\t\tmyName: '',\n\t\t\t\tconfrId: '',\n\t\t\t\tenableCamera: true,\n\t\t\t\ttime: '',\n\t\t\t\tcontext: {}\n\t\t\t}\n\t\t},\n\t\tprops: {\n\t\t  username: {\n\t\t    type: Object,\n\t\t    default: () => ({}),\n\t\t  },\n\t\t  action: {\n\t\t    type: Object,\n\t\t    default: {},\n\t\t  },\n\t\t  groupId:{\n\t\t    type: String,\n\t\t    default: '',\n\t\t  },\n\t\t},\n\t\tmethods: {\n\t\t\tjoinRoom(data){\n\t\t\t\tlet me = this;\n\t\t\t\tconsole.log('joinRoom', data)\n\t\t\t\tme.context = uni.createLivePusherContext(\"livePusher\", me);\n\t\t\t\tconsole.log('我的播放组件', me.context)\n\t\t\t\tvar context = this.context\n\t\t\t\tif (context && context.ctx && context.ctx.attr && context.ctx.attr.url) {\n\t\t\t\t\tcontext.stop()\n\t\t\t\t}\n\t\t\t\tlet id = wx.WebIM.conn.getUniqueId();\n\t\t\t\tlet roomName = 'wxConfr' + id //随机的房间名，防止和别人的房间名冲突\n\t\t\t\tlet rec = wx.getStorageSync(\"rec\") || false;\n\t\t\t\tlet recMerge = wx.getStorageSync(\"recMerge\") || false;\n\t\t\t\tlet params = {\n\t\t\t\t\troomName,\n\t\t\t\t\tpassword: '',\n\t\t\t\t\trole: 7,\n\t\t\t\t\tconfig: {\n\t\t\t\t\t\trec,\n\t\t\t\t\t\trecMerge\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (data) {\n\t\t\t\t\tparams.roomName = data.roomName\n\t\t\t\t\tparams.password = data.password\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\twx.emedia.mgr.joinRoom(params).then((res) => {\n\t\t\t\t\tconsole.log('res', res)\n\t\t\t\t\tlet confrId = res.confrId\n\t\t\t\t\tme.setData({\n\t\t\t\t\t\tconfrId: confrId\n\t\t\t\t\t})\n\t\t\t\t\tme.$emit('createConfrSuccess', {confrId: confrId, groupId: me.username.groupId, roomName: params.roomName, password: params.password})\n\t\t\t\t\t\n\t\t\t\t\tconsole.log('--------+--+----+---+--------')\n\t\t\t\t\tlet rtcId = wx.emedia.util.getRtcId()\n\t\t\t\t\tconsole.log(11111111111111, confrId)\n\t\t\t\t\twx.emedia.mgr.pubStream(rtcId).then(function(res){\n\t\t\t\t\t\tconsole.log('pubUrl-------------', res.data.rtmp)\n\t\t\t\t\t\tconsole.log(2222222222222)\n\t\t\t\t\t\tme.setData({\n\t\t\t\t\t\t\tpubUrl: res.data.rtmp\n\t\t\t\t\t\t})\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tconsole.log('55555555555', me)\n\t\t\t\t\t\t\tconsole.log(me.context)\n\t\t\t\t\t\t\tme.context.start()\n\t\t\t\t\t\t}, 500)\n\t\t\t\t\t}).catch(e => {\n\t\t\t\t\t    console.log(4444444, e)   //404\n\t\t\t\t\t    return f(false);  //即便返回了一个成功的promise,下面的finally也会执行,如果返回的是失败的promise,控制台最后一行会报错uncaught (in promise) 404\n\t\t\t\t\t})\n\t\t\t\t\t.finally( (e) => {\n\t\t\t\t\t    console.log(100,e)  //100\n\t\t\t\t\t})\n\t\t\t\t\tconsole.log(33333333333333, me.pubUrl)\n\t\t\t\t})\n\t\t\t\t\n\t\t\t\t\n\t\t\t},\n\t\t\tcreateConf(){\n\t\t\t\tconsole.log('>>> createConf');\n\t\t\t\t\n\t\t\t\tvar me = this\n\t\t\t\tlet rec = wx.getStorageSync(\"rec\") || false;\n\t\t\t\tlet recMerge = wx.getStorageSync(\"recMerge\") || false;\n\t\t\t\t//参数：会议类型 密码 是否录制 是否合并\n\t\t\t\twx.emedia.mgr.createConference(10, '', rec, recMerge).then(function(data){\n\t\t\t\t\tconsole.log('成功', data)\n\t\t\t\t\tlet ticket = data.data.ticket\n\t\t\t\t\tlet ticketJosn = JSON.parse(ticket)\n\t\t\t\t\tlet confrId = ticketJosn.confrId\n\t\n\t\t\t\t\twx.emedia.mgr.joinConferenceWithTicket(confrId, ticket).then(function(res){\n\t\t\t\t\t\tconsole.log('加入会议成功', res)\n\t\t\t\t\t})\n\t\t\t\t\t// wx.emedia.mgr.joinConference(confrId, '').then(function(res){\n\t\t\t\t\t// \tconsole.log('加入会议成功', res)\n\t\t\t\t\t// })\n\t\t\t\t\t\n\t\t\t\t\tme.setData({\n\t\t\t\t\t\tconfrId\n\t\t\t\t\t})\n\t\t\t\t\tme.$emit('createConfrSuccess', {confrId: confrId, groupId: me.username.groupId})\n\t\t\t\t})\n\t\t\t},\n\t\n\t\t\tjoinConf(data){\n\t\t\t\tconsole.log('加入会议 ————-------————')\n\t\t\t\tconsole.log(data)\n\t\t\t\tlet me = this\n\t\t\t\twx.emedia.mgr.getConferenceTkt(data.confrId, data.password).then(function(res){\n\t\t\t\t\tconsole.log('申请reqTkt成功', res.data)\n\t\t\t\t\tlet ticket = res.data.ticket || ''\n\t\t\t\t\tlet tktObj = JSON.parse(ticket)\n\t\t\t\t\twx.emedia.mgr.joinConferenceWithTicket(data.confrId, ticket).then(function(res){\n\t\t\t\t\t\tconsole.log('加入会议成功', res)\n\t\t\t\t\t})\n\t\t\t\t\tme.setData({\n\t\t\t\t\t\tconfrId: tktObj.confrId\n\t\t\t\t\t})\n\t\t\t\t\tme.$emit('createConfrSuccess', {confrId: tktObj.confrId, groupId: me.username.groupId})\n\t\t\t\t})\n\t\t\t},\n\t\t\t\n\t\t\ttogglePlay(){\n\t\t\t\tlet me = this\n\t\t\t\tconsole.log(\"%c togglePlay\", \"color:green\")\n\t\n\t\t\t\t// this.LivePusherContext.stop()\n\t\t\t\tthis.setData({\n\t\t\t\t\tenableCamera: !me.enableCamera,\n\t\t\t\t\tpubUrl: me.pubUrl,\n\t\t\t\t\tvideoIcon: this.videoIcon == 'video_white'?'video_gray': 'video_white',\n\t\t\t\t\tvideoColor: this.videoColor == '#fff'? '#aaa': '#fff'\n\t\t\t\t}, () => {\n\t\t\t\t\tthis.LivePusherContext.start()\n\t\t\t\t})\n\t\t\t},\n\t\n\t\t\ttoggleCamera(){\n\t\t\t\tconsole.log(\"%c toggleCamera\", \"color:green\")\n\t\t\t\tlet me = this\n\t\t\t\t// me.LivePusherContext.stop()\n\t\t\t\tme.LivePusherContext.switchCamera({\n\t\t\t\t\tsuccess: function(){\n\t\t\t\t\t\tme.setData({\n\t\t\t\t\t\t\tdevicePosition: me.devicePosition == 'fron' ? 'back' : 'front',\n\t\t\t\t\t\t\tdevicePositionIcon: me.devicePositionIcon =='switchCamera_white'?'switchCamera_gray': 'switchCamera_white',\n\t\t\t\t\t\t\tdevicePositionColor: me.devicePositionColor == '#fff'? '#aaa':'#fff'\n\t\t\t\t\t\t}, () => {\n\t\t\t\t\t\t\t// me.LivePusherContext.start()\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t},\n\t\n\t\t\ttoggleMuted(){\n\t\t\t\tconsole.log(\"%c toggleMuted\", \"color:green\")\n\t\t\t\tthis.setData({\n\t\t\t\t\tmuted: !this.muted,\n\t\t\t\t\tmicphoneIcon: this.micphoneIcon == 'micphone_white'? 'micphone_gray': 'micphone_white',\n\t\t\t\t\tmicphoneColor: this.micphoneColor == '#fff'? '#aaa': '#fff'\n\t\t\t\t})\n\t\t\t},\n\t\n\t\t\ttoggleBeauty(){\n\t\t\t\tthis.setData({\n\t\t\t\t\tbeauty: this.beauty == 0 ? 9 : 0,\n\t\t\t\t\tbeautyColor: this.beautyColor == '#fff'? '#aaa': '#fff',\n\t\t\t\t\tbeautyIcon: this.beautyIcon == 'beauty' ? 'beauty_gray': 'beauty'\n\t\t\t\t})\n\t\t\t},\n\t\n\t\t\thangup(){\n\t\t\t\tconsole.log('挂断', this.confrId)\n\t\t\t\twx.emedia.mgr.exitConference(this.confrId)\n\t\t\t\tthis.$emit('hangup')\n\t\t\t\tthis.stopTimer()\n\t\t\t},\n\t\t\tinviteMember(){\n\t\t\t\tthis.$emit('inviteMember', this.groupId)\n\t\t\t},\n\t\t\t// statechange(e){\n\t\t\t// \tconsole.log('>>>>>>>>>live-pusher code:', e.detail)\n\t\t\t// \tif (e.detail.code === 5001) {\n\t\t\t// \t\t// 部分安卓手机在接电话时会停止推拉流报错，状态码5001，此时退出会议。 https://developers.weixin.qq.com/community/develop/doc/0006ac6d7a4968fa675a49fef53c00\n\t\t\t// \t\tthis.hangup()\n\t\t\t// \t\tconsole.error('由于有电话接入，已退出会议')\n\t\t\t// \t}\n\t\t\t// },\n\t\t\tnetstatusChange(e){\n\t\t\t\tconsole.log('>>>>>>>>>>net status:', e.detail)\n\t\t\t},\n\t\n\t\t\tgetTimer(){\n\t\t\t\tlet count = 0;\n\t\t\t\tlet time = '00:00:00'\n\t\t\t\tthis.timer = setInterval(() => {\n\t\t\t\t\tcount++;\n\t\t\t\t\tlet s = showNum(count % 60);\n\t\t\t\t\tlet m = showNum(parseInt((count / 60)) % 60)\n\t\t\t\t\tlet h = showNum(parseInt(count / 60 / 60))\n\t\t\t\t\ttime = `${h}:${m}:${s}`\n\t\t\t\t\tthis.setData({\n\t\t\t\t\t\ttime\n\t\t\t\t\t})\n\t\t\t\t}, 1000)\n\t\n\t\t\t\tfunction showNum(num) {\n\t\t\t\t\tif (num < 10) {\n\t\t\t\t\t\treturn '0' + num\n\t\t\t\t\t}\n\t\t\t\t\treturn num\n\t\t\t\t}\n\t\n\t\t\t},\n\t\t\tstopTimer(){\n\t\t\t\tclearInterval(this.timer)\n\t\t\t},\n\t\t\terror(err){\n\t\t\t\tconsole.log('EEEEEEEEEEEEE', err)\n\t\t\t},\n\t\t\tstatechange(state){\n\t\t\t\tconsole.log(\"SSSSSSSSSSS\", state)\n\t\t\t}\n\t\t},\n\t\t\n\t\tmounted() {\n\t\t\tconsole.log('进入')\n\t\t\twx.setKeepScreenOn({\n\t\t\t  keepScreenOn: true\n\t\t\t})\n\t\t\tconsole.log('进入111')\n\t\t\tthis.setData({\n\t\t\t\tmyName: wx.WebIM.conn.context.userId\n\t\t\t})\n\t\t\tconsole.log('进入222')\n\t\t\tthis.getTimer()\n\t\t\tvar me = this\n\t\t\tlet subUrls = []\n\t\t\tlet obj = {};\n\t\t\tconsole.log('进入333')\n\t\t\tthis.LivePusherContext = uni.createLivePusherContext('livePusher',this)\n\t\t\tconsole.log('this.LivePusherContext ..', this.LivePusherContext)\n\t\t\tif(this.action&&this.action.action == 'join'){\n\t\t\t\tconsole.log('join')\n\t\t\t\t// 音视频sdk提供两种创建、加入会议的api 使用任意一种都可以：（1） 一种是通过会议id ticket 或者 会议id 密码加入会议 如使用下面 joinConf\n\t\t\t\t// （2）另一种是通过房间名 密码加入 如使用下面joinRoom\n\n\t\t\t\t//this.joinConf(this.action) // （1）\n\t\t\t\t//this.joinRoom(this.action) // （2）\n\t\t\t\tif (this.action.roomName) {\n\t\t\t\t\tconsole.log('使用joinroom')\n\t\t\t\t\tthis.joinRoom(this.action)\n\t\t\t\t}else{\n\t\t\t\t\tconsole.log('使用joinConf')\n\t\t\t\t\tthis.joinConf(this.action)\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\t// 创建会议同样是两种api （1）一种是使用createConf 单纯创建一个会议，需要再申请ticket 或者用密码加入会议 如使用下面的createConf\n\t\t\t\t// （2）也可以使用joinRoom，通过房间名、密码创建房间并直接加入 不需再进行加入会议的操作\n\t\t\t\tthis.joinRoom() // （1）\n\t\t\t\t//this.createConf() // （2）\n\t\t\t}\n\t\t\twx.emedia.mgr.onMediaChanaged = function(e){\n\t\t\t\tconsole.log('onMediaChanaged', e)\n\t\t\t}\n\t\t\twx.emedia.mgr.onConferenceExit = function(e){\n\t\t\t\tconsole.log('onConferenceExit', e)\n\t\t\t}\n\t\t\twx.emedia.mgr.onMemberExited = function(reason){\n\t\t\t\tconsole.log('onMemberExited', reason)\n\t\t\t};\n \n\t\t\twx.emedia.mgr.onStreamControl = function(mem){\n\t\t\t\tconsole.log('onStreamControl', mem)\n\t\t\t}\n\n\t\t\twx.emedia.mgr.onStreamControl.onSoundChanage = function(a, b, c, d){\n\t\t\t\tconsole.log('onSoundChanage')\n\t\t\t}\n\n\t\t\twx.emedia.mgr.onReconnect = function (res, ent){\n\t\t\t\t// 发生断网重连，相当于重新加入会议\n\n\t\t\t\t// 清空live-player 否则在原来的后面追加，导致原来的黑屏显示\n\t\t\t\tsubUrls = []\n\n\t\t\t\t// 重新加入恢复到初始状态，防止和控制按钮状态不符\n\n\t\t\t\t// 重连后摄像头方向不会改变\n\t\t\t\tme.setData({\n\t\t\t\t\tsubUrls: [],\n\t\t\t\t\tshowInvite: true,\n\t\t\t\t\tdevicePosition: \"front\",\n\t\t\t\t\tmuted: false,\n\t\t\t\t\tplayVideoMuted: false,\n\n\t\t\t\t\t\n\t\t\t\t\tmicphoneIcon: 'micphone_white',\n\t\t\t\t\tmicphoneColor: '#fff',\n\t\t\t\t\tvideoIcon: 'video_white',\n\t\t\t\t\tbeautyIcon: 'beauty',\n\t\t\t\t\tvideoColor: '#fff',\n\t\t\t\t\tbeauty: 9,\n\t\t\t\t\tbeautyColor: '#fff',\n\t\t\t\t\tenableCamera: true\n\t\t\t\t})\n\t\t\t}\n\n\t\t\twx.emedia.mgr.onMemberJoined = function(mem){\n\t\t\t\tconsole.log(\"++++++++++ member\", mem)\n\t\t\t\tvar jid = wx.WebIM.conn.context.jid\n\t\t\t\tlet identityName = jid.appKey + '_' + jid.name+ '@' + jid.domain\n\t\t\t\t// let identityName = wx.WebIM.conn.context.jid.split(\"/\")[0]\n\t\t\t\t// 如果是自己进入会议了，开始发布流\n\t\t\t\tif(mem.name == identityName){\n\t\t\t\t\tlet rtcId = wx.emedia.util.getRtcId()\n\t\t\t\t\twx.emedia.mgr.pubStream(rtcId).then(function(res){\n\t\t\t\t\t\tme.setData({\n\t\t\t\t\t\t\tpubUrl: res.data.rtmp\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\n\t\t\t\t\tvar enableCamera = me.enableCamera;\n\t\t\t\t\tconsole.warn(\"begin enable camera\", me.enableCamera);\n\n\t\t\t\t\t//默认enableCamera为false  关闭摄像头时声音不会有延迟，否则有延迟\n\t\t\t\t\t//所以最好别用autopush\n\t\t\t\t\tme.setData({\n\t\t\t\t\t\tenableCamera: false,\n\t\t\t\t\t\tpubUrl: me.url + 'record_type=audio' || 'https://domain/push_stream',\n\t\t\t\t\t}, () => {\n\t\t\t\t\t\t// var enableCameraDefault = true\n\t\t\t\t\t\t//if(!enableCameraDefault){ //治疗不推流的毛病\n\t\t\t\t\t\t\t// console.log('关闭摄像头推流')\n\t\t\t\t\t\t\t// setTimeout(() => {\n\t\t\t\t\t\t\t// \tme.LivePusherContext.start({\n\t\t\t\t\t\t\t// \t\tsuccess: function () {\n\t\t\t\t\t\t\t\t\t\t// console.log('关闭摄像头推流', enableCamera)\n\t\t\t\t\t\t\t\t\t\tenableCamera && me.setData({enableCamera: enableCamera})\n\t\t\t\t\t\t\t// \t\t}\n\t\t\t\t\t\t\t// \t})\n\t\t\t\t\t\t\t// }, 1500)\n\t\t\t\t\t\t// }else{\n\t\t\t\t\t\t// \tme.LivePusherContext.start({\n\t\t\t\t\t\t   //  \tsuccess: function () {\n\t\t\t\t\t\t   //  \t\tconsole.log('开始推流了', enableCamera)\n\t\t\t\t\t\t   //    \t\tenableCamera && me.setData({enableCamera: enableCamera})\n\t\t\t\t\t\t   //  \t}\n\t\t\t\t\t\t   //  })\n\t\t\t\t\t\t// }\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t\twx.emedia.mgr.onStreamAdded = function(stream){\n\t\t\t\tconsole.log('%c onAddStream', 'color: green', stream)\n\t\t\t\tlet streamId = stream.id\n\t\t\t\t// setTimeout(() => {\n\t\t\t\t\tif(subUrls.length > 8){\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\twx.emedia.mgr.subStream(streamId).then(function(data){\n\t\t\t\t\t\tconsole.log('%c 订阅流成功', 'color:green', data)\n\t\t\t\t\t\t// let playContext = wx.createLivePlayerContext(streamId, me)\n\t\t\t\t\t\tlet subUrl = {\n\t\t\t\t\t\t\tstreamId: streamId,\n\t\t\t\t\t\t\tsubUrl: data.data.rtmp,\n\t\t\t\t\t\t\tmemName: stream.memName.split(\"_\")[1].split(\"@\")[0],\n\t\t\t\t\t\t\t// playContext: playContext\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsubUrls.push(subUrl)\n\t\t\t\t\t\tconsole.log('%c subUrls 11 ....', \"background:yellow\")\n\t\t\t\t\t\tconsole.log(subUrls)\n\t\n\t\t\t\t\t\tme.setData({\n\t\t\t\t\t\t\tsubUrls: subUrls,\n\t\t\t\t\t\t\tshowInvite: false\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t// }, 2000)\n\n\t\t\t}\n\t\t\twx.emedia.mgr.onStreamRemoved = function(stream){\n\t\t\t\tconsole.log('%c onRemoveStream', 'color: red', stream)\n\t\t\t\tsubUrls = subUrls.filter((item) => {\n\t\t\t\t\tif(item.streamId != stream.id){\n\t\t\t\t\t\treturn item\n\t\t\t\t\t}else{\n\t\t\t\t\t\tconsole.log('%c ------', 'backgroukd:yellow')\n\t\t\t\t\t\tconsole.log(item)\n\t\t\t\t\t\t// item.playContext.stop({\n\t\t\t\t\t\t// \tsuccess: function(){\n\t\t\t\t\t\t// \t\tconsole.log('关闭成功')\n\t\t\t\t\t\t// \t},\n\t\t\t\t\t\t// \tcomplete: function(){\n\t\t\t\t\t\t// \t\tconsole.log('关闭成功')\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// })\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tobj[stream.id] = false\n\t\t\t\tme.setData({\n\t\t\t\t\tsubUrls: subUrls,\n\t\t\t\t})\n\t\t\t\tconsole.log('subUrls', subUrls)\n\t\t\t},\n\t\t\twx.emedia.mgr.onConfrAttrsUpdated = function(e){\n\t\t\t\tconsole.log('onConfrAttrsUpdated: ', e)\n\t\t\t}\n\t\t\t\n\t\t},\n\t\n\t}\n</script>\n\n\n"],"sourceRoot":""}