require('../../../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["chat_pages/components/chat/multiemedia/index"],{"4a30":function(e,o,t){"use strict";t.d(o,"b",(function(){return n})),t.d(o,"c",(function(){return a})),t.d(o,"a",(function(){}));var n=function(){var e=this.$createElement,o=(this._self._c,this.subUrls.length);this.$mp.data=Object.assign({},{$root:{g0:o}})},a=[]},"810d":function(e,o,t){"use strict";t.r(o);var n=t("b4ec"),a=t.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){t.d(o,e,(function(){return n[e]}))}(i);o["default"]=a.a},b4ec:function(e,o,t){"use strict";(function(e,t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n={data:function(){return{pubUrl:"",subUrls:[],showInvite:!0,devicePosition:"front",muted:!1,playVideoMuted:!1,devicePositionIcon:"switchCamera_white",devicePositionColor:"#fff",micphoneIcon:"micphone_white",beautyIcon:"beauty",micphoneColor:"#fff",videoIcon:"video_white",videoColor:"#fff",beauty:9,beautyColor:"#fff",myName:"",confrId:"",enableCamera:!0,time:"",context:{}}},props:{username:{type:Object,default:function(){return{}}},action:{type:Object,default:{}},groupId:{type:String,default:""}},methods:{joinRoom:function(o){var n=this;console.log("joinRoom",o),n.context=e.createLivePusherContext("livePusher",n),console.log("我的播放组件",n.context);var a=this.context;a&&a.ctx&&a.ctx.attr&&a.ctx.attr.url&&a.stop();var i=t.WebIM.conn.getUniqueId(),r="wxConfr"+i,c=t.getStorageSync("rec")||!1,s=t.getStorageSync("recMerge")||!1,l={roomName:r,password:"",role:7,config:{rec:c,recMerge:s}};o&&(l.roomName=o.roomName,l.password=o.password),t.emedia.mgr.joinRoom(l).then((function(e){console.log("res",e);var o=e.confrId;n.setData({confrId:o}),n.$emit("createConfrSuccess",{confrId:o,groupId:n.username.groupId,roomName:l.roomName,password:l.password}),console.log("--------+--+----+---+--------");var a=t.emedia.util.getRtcId();console.log(0xa1b01d4b1c7,o),t.emedia.mgr.pubStream(a).then((function(e){console.log("pubUrl-------------",e.data.rtmp),console.log(2222222222222),n.setData({pubUrl:e.data.rtmp}),setTimeout((function(){console.log("55555555555",n),console.log(n.context),n.context.start()}),500)})).catch((function(e){return console.log(4444444,e),f(!1)})).finally((function(e){console.log(100,e)})),console.log(33333333333333,n.pubUrl)}))},createConf:function(){console.log(">>> createConf");var e=this,o=t.getStorageSync("rec")||!1,n=t.getStorageSync("recMerge")||!1;t.emedia.mgr.createConference(10,"",o,n).then((function(o){console.log("成功",o);var n=o.data.ticket,a=JSON.parse(n),i=a.confrId;t.emedia.mgr.joinConferenceWithTicket(i,n).then((function(e){console.log("加入会议成功",e)})),e.setData({confrId:i}),e.$emit("createConfrSuccess",{confrId:i,groupId:e.username.groupId})}))},joinConf:function(e){console.log("加入会议 ————-------————"),console.log(e);var o=this;t.emedia.mgr.getConferenceTkt(e.confrId,e.password).then((function(n){console.log("申请reqTkt成功",n.data);var a=n.data.ticket||"",i=JSON.parse(a);t.emedia.mgr.joinConferenceWithTicket(e.confrId,a).then((function(e){console.log("加入会议成功",e)})),o.setData({confrId:i.confrId}),o.$emit("createConfrSuccess",{confrId:i.confrId,groupId:o.username.groupId})}))},togglePlay:function(){var e=this;console.log("%c togglePlay","color:green"),this.setData({enableCamera:!this.enableCamera,pubUrl:this.pubUrl,videoIcon:"video_white"==this.videoIcon?"video_gray":"video_white",videoColor:"#fff"==this.videoColor?"#aaa":"#fff"},(function(){e.LivePusherContext.start()}))},toggleCamera:function(){console.log("%c toggleCamera","color:green");var e=this;e.LivePusherContext.switchCamera({success:function(){e.setData({devicePosition:"fron"==e.devicePosition?"back":"front",devicePositionIcon:"switchCamera_white"==e.devicePositionIcon?"switchCamera_gray":"switchCamera_white",devicePositionColor:"#fff"==e.devicePositionColor?"#aaa":"#fff"},(function(){}))}})},toggleMuted:function(){console.log("%c toggleMuted","color:green"),this.setData({muted:!this.muted,micphoneIcon:"micphone_white"==this.micphoneIcon?"micphone_gray":"micphone_white",micphoneColor:"#fff"==this.micphoneColor?"#aaa":"#fff"})},toggleBeauty:function(){this.setData({beauty:0==this.beauty?9:0,beautyColor:"#fff"==this.beautyColor?"#aaa":"#fff",beautyIcon:"beauty"==this.beautyIcon?"beauty_gray":"beauty"})},hangup:function(){console.log("挂断",this.confrId),t.emedia.mgr.exitConference(this.confrId),this.$emit("hangup"),this.stopTimer()},inviteMember:function(){this.$emit("inviteMember",this.groupId)},netstatusChange:function(e){console.log(">>>>>>>>>>net status:",e.detail)},getTimer:function(){var e=this,o=0,t="00:00:00";function n(e){return e<10?"0"+e:e}this.timer=setInterval((function(){o++;var a=n(o%60),i=n(parseInt(o/60)%60),r=n(parseInt(o/60/60));t="".concat(r,":").concat(i,":").concat(a),e.setData({time:t})}),1e3)},stopTimer:function(){clearInterval(this.timer)},error:function(e){console.log("EEEEEEEEEEEEE",e)},statechange:function(e){console.log("SSSSSSSSSSS",e)}},mounted:function(){console.log("进入"),t.setKeepScreenOn({keepScreenOn:!0}),console.log("进入111"),this.setData({myName:t.WebIM.conn.context.userId}),console.log("进入222"),this.getTimer();var o=this,n=[],a={};console.log("进入333"),this.LivePusherContext=e.createLivePusherContext("livePusher",this),console.log("this.LivePusherContext ..",this.LivePusherContext),this.action&&"join"==this.action.action?(console.log("join"),this.action.roomName?(console.log("使用joinroom"),this.joinRoom(this.action)):(console.log("使用joinConf"),this.joinConf(this.action))):this.joinRoom(),t.emedia.mgr.onMediaChanaged=function(e){console.log("onMediaChanaged",e)},t.emedia.mgr.onConferenceExit=function(e){console.log("onConferenceExit",e)},t.emedia.mgr.onMemberExited=function(e){console.log("onMemberExited",e)},t.emedia.mgr.onStreamControl=function(e){console.log("onStreamControl",e)},t.emedia.mgr.onStreamControl.onSoundChanage=function(e,o,t,n){console.log("onSoundChanage")},t.emedia.mgr.onReconnect=function(e,t){n=[],o.setData({subUrls:[],showInvite:!0,devicePosition:"front",muted:!1,playVideoMuted:!1,micphoneIcon:"micphone_white",micphoneColor:"#fff",videoIcon:"video_white",beautyIcon:"beauty",videoColor:"#fff",beauty:9,beautyColor:"#fff",enableCamera:!0})},t.emedia.mgr.onMemberJoined=function(e){console.log("++++++++++ member",e);var n=t.WebIM.conn.context.jid,a=n.appKey+"_"+n.name+"@"+n.domain;if(e.name==a){var i=t.emedia.util.getRtcId();t.emedia.mgr.pubStream(i).then((function(e){o.setData({pubUrl:e.data.rtmp})}));var r=o.enableCamera;console.warn("begin enable camera",o.enableCamera),o.setData({enableCamera:!1,pubUrl:o.url+"record_type=audio"||!1},(function(){r&&o.setData({enableCamera:r})}))}},t.emedia.mgr.onStreamAdded=function(e){console.log("%c onAddStream","color: green",e);var a=e.id;n.length>8||t.emedia.mgr.subStream(a).then((function(t){console.log("%c 订阅流成功","color:green",t);var i={streamId:a,subUrl:t.data.rtmp,memName:e.memName.split("_")[1].split("@")[0]};n.push(i),console.log("%c subUrls 11 ....","background:yellow"),console.log(n),o.setData({subUrls:n,showInvite:!1})}))},t.emedia.mgr.onStreamRemoved=function(e){console.log("%c onRemoveStream","color: red",e),n=n.filter((function(o){if(o.streamId!=e.id)return o;console.log("%c ------","backgroukd:yellow"),console.log(o)})),a[e.id]=!1,o.setData({subUrls:n}),console.log("subUrls",n)},t.emedia.mgr.onConfrAttrsUpdated=function(e){console.log("onConfrAttrsUpdated: ",e)}}};o.default=n}).call(this,t("543d")["default"],t("bc2e")["default"])},f3dc:function(e,o,t){"use strict";t.r(o);var n=t("4a30"),a=t("810d");for(var i in a)["default"].indexOf(i)<0&&function(e){t.d(o,e,(function(){return a[e]}))}(i);var r=t("f0c5"),c=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);o["default"]=c.exports}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'chat_pages/components/chat/multiemedia/index-create-component',
    {
        'chat_pages/components/chat/multiemedia/index-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("f3dc"))
        })
    },
    [['chat_pages/components/chat/multiemedia/index-create-component']]
]);
