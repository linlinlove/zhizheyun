(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["common/main"],{"378d":function(e,o,n){"use strict";n.r(o);var t=n("856c"),s=n.n(t);for(var a in t)["default"].indexOf(a)<0&&function(e){n.d(o,e,(function(){return t[e]}))}(a);o["default"]=s.a},"5b61":function(e,o,n){"use strict";var t=n("f2f4"),s=n.n(t);s.a},"856c":function(e,o,n){"use strict";(function(e,t){var s=n("4ea4");Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var a=s(n("9451")),r=e.WebIM=n("9754")["default"],i=n("e4a8"),c=n("cc4a"),u=n("aafc");function f(e){var o=e.id,n=new r.message("read",r.conn.getUniqueId());n.set({id:o,to:e.from}),r.conn.send(n.body)}function l(e){return"error"!==e.type||(t.showToast({title:e.errorText}),!1)}function d(){var e=getCurrentPages();if(e.length>0){var o=e[e.length-1];return o.route}return"/"}function g(e){var o=t.getStorageSync("myUsername");t.getStorageInfo({success:function(n){var s=n.keys,a=[];s.forEach((function(e){e.indexOf(o)>-1&&-1==e.indexOf("rendered_")&&a.push(e)}));var r=a.reduce((function(e,o,n){var s;return s=t.getStorageSync(o)||[],e+s.length}),0);getApp().globalData.unReadMessageNum=r,u.fire("em.unreadspot",e)}})}function p(){return r.conn.getGroup({limit:50,success:function(e){t.setStorage({key:"listGroup",data:e.data})},error:function(e){console.log(e)}})}var v={globalData:{baseUrl:a.default,unReadMessageNum:0,userInfo:null,saveFriendList:[],saveGroupInvitedList:[],isIPX:!1,conn:{closed:!1,curOpenOpt:{},open:function(e){t.showLoading({title:"正在初始化客户端..",mask:!0}),this.curOpenOpt=e,r.conn.open(e),this.closed=!1},reopen:function(){this.closed&&(r.conn.open(this.curOpenOpt),this.closed=!1)}},onLoginSuccess:function(e){t.hideLoading(),t.redirectTo({url:"../chat/chat?myName="+e})},getUserInfo:function(e){var o=this;this.userInfo?"function"==typeof e&&e(this.userInfo):t.login({success:function(){t.getUserInfo({success:function(n){o.userInfo=n.userInfo,"function"==typeof e&&e(o.userInfo)}})}})},checkIsIPhoneX:function(){var e=this;t.getSystemInfo({success:function(o){o.model&&-1!=o.model.search("iPhone X")&&(e.isIPX=!0)}})}},onLaunch:function(){var e=this,o=t.getStorageSync("logs")||[];o.unshift(Date.now()),t.setStorageSync("logs",o),u.on("em.main.ready",(function(){g()})),u.on("em.chatroom.leave",(function(){g()})),u.on("em.chat.session.remove",(function(){g()})),u.on("em.chat.audio.fileLoaded",(function(){g()})),u.on("em.main.deleteFriend",(function(){g()})),u.on("em.chat.audio.fileLoaded",(function(){g()})),r.conn.listen({onCustomMessage:function(e){console.log(e,"自定义消息"),i.saveReceiveMsg(e,e.type)},onOpened:function(o){"pages/login/login"!=d()&&"pages/login_token/login_token"!=d()||e.globalData.onLoginSuccess(t.getStorageSync("myUsername").toLowerCase()),console.log(r.conn.isOpened(),"isOpened")},isOpened:function(){console.log(message,"链接状态2")},onReconnect:function(){t.showToast({title:"重连中...",duration:2e3})},onSocketConnected:function(){t.showToast({title:"socket连接成功",duration:2e3})},onClosed:function(){t.showToast({title:"网络已断开",icon:"none",duration:2e3}),console.log("断开链接"),e.globalData.conn.closed=!0,r.conn.close()},onInviteMessage:function(o){e.globalData.saveGroupInvitedList.push(o),u.fire("em.invite.joingroup",o)},onReadMessage:function(e){},onPresence:function(o){switch(o.type){case"unsubscribe":break;case"subscribe":for(var n=0;n<e.globalData.saveFriendList.length;n++)if(e.globalData.saveFriendList[n].from===o.from)return e.globalData.saveFriendList[n]=o,void u.fire("em.subscribe");i.saveReceiveMsg(o,"INFORM"),e.globalData.saveFriendList.push(o),u.fire("em.subscribe");break;case"subscribed":t.showToast({title:"添加成功",duration:1e3}),u.fire("em.subscribed");break;case"unsubscribed":u.fire("em.unsubscribed");break;case"direct_joined":p(),t.showToast({title:"已进群",duration:1e3});break;case"memberJoinPublicGroupSuccess":p(),t.showToast({title:"已进群",duration:1e3});break;case"invite":for(var s=0;s<e.globalData.saveGroupInvitedList.length;s++)if(e.globalData.saveGroupInvitedList[s].from===o.from)return e.globalData.saveGroupInvitedList[s]=o,void u.fire("em.invite.joingroup");e.globalData.saveGroupInvitedList.push(o),u.fire("em.invite.joingroup"),i.saveReceiveMsg(o,"INFORM");break;case"unavailable":u.fire("em.contacts.remove"),u.fire("em.group.leaveGroup",o);break;case"deleteGroupChat":u.fire("em.invite.deleteGroup",o);break;case"leaveGroup":u.fire("em.group.leaveGroup",o);break;case"removedFromGroup":u.fire("em.group.leaveGroup",o);break;default:break}},onRoster:function(e){},onVideoMessage:function(e){console.log("onVideoMessage: ",e),e&&i.saveReceiveMsg(e,c.VIDEO),g(e),f(e)},onAudioMessage:function(e){console.log("onAudioMessage",e),e&&(l(e)&&i.saveReceiveMsg(e,c.AUDIO),g(e),f(e))},onCmdMessage:function(e){console.log("onCmdMessage",e),e&&(l(e)&&i.saveReceiveMsg(e,c.CMD),g(e),f(e))},onTextMessage:function(e){console.log("onTextMessage",e),e&&(l(e)&&i.saveReceiveMsg(e,c.TEXT),g(e),f(e))},onEmojiMessage:function(e){console.log("onEmojiMessage",e),e&&(l(e)&&i.saveReceiveMsg(e,c.EMOJI),g(e),f(e))},onPictureMessage:function(e){console.log("onPictureMessage",e),e&&(l(e)&&i.saveReceiveMsg(e,c.IMAGE),g(e),f(e))},onFileMessage:function(e){console.log("onFileMessage",e),e&&(l(e)&&i.saveReceiveMsg(e,c.FILE),g(e),f(e))},onError:function(e){console.log(e,5555),28!=e.type&&1!=e.type&&39!=e.type||r.conn.open({user:t.getStorageSync("myUsername"),pwd:"123456",appkey:r.config.appKey}),console.log(r.config.appkey,"WebIM.config.appKey"),console.log(e,4545),e.type==r.statusCode.WEBIM_CONNCTION_OPEN_ERROR&&(t.hideLoading(),u.fire("em.error.passwordErr")),e.type==r.statusCode.WEBIM_CONNCTION_AUTH_ERROR&&(t.hideLoading(),u.fire("em.error.tokenErr")),"socket_error"==e.type&&(console.log("socket_errorsocket_error",e),t.showToast({title:"网络已断开",icon:"none",duration:2e3}),u.fire("em.error.sendMsgErr",e))}}),!r.conn.isOpened()&&t.getStorageSync("myUsername")&&r.conn.open({user:t.getStorageSync("myUsername"),pwd:"123456",appkey:r.config.appKey}),this.globalData.checkIsIPhoneX()},methods:{}};o.default=v}).call(this,n("bc2e")["default"],n("543d")["default"])},ad33:function(e,o,n){"use strict";n.r(o);var t=n("378d");for(var s in t)["default"].indexOf(s)<0&&function(e){n.d(o,e,(function(){return t[e]}))}(s);n("5b61");var a=n("f0c5"),r=Object(a["a"])(t["default"],void 0,void 0,!1,null,null,null,!1,void 0,void 0);o["default"]=r.exports},f2f4:function(e,o,n){},f87f:function(e,o,n){"use strict";(function(e,o){var t=n("4ea4"),s=t(n("9523"));n("e25e");var a=t(n("66fd")),r=t(n("ad33")),i=t(n("e565")),c=t(n("9801"));function u(e,o){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);o&&(t=t.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),n.push.apply(n,t)}return n}e.__webpack_require_UNI_MP_PLUGIN__=n,a.default.use(c.default),a.default.use(i.default),a.default.config.productionTip=!1,a.default.mixin({methods:{setData:function(e,o){var n,t,s=this,a=[];Object.keys(e).forEach((function(o){a=o.split("."),n=e[o],t=s.$data,a.forEach((function(e,o){o+1==a.length?s.$set(t,e,n):t[e]||s.$set(t,e,{}),t=t[e]}))})),o&&o()}}}),r.default.mpType="app";var f=new a.default(function(e){for(var o=1;o<arguments.length;o++){var n=null!=arguments[o]?arguments[o]:{};o%2?u(Object(n),!0).forEach((function(o){(0,s.default)(e,o,n[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))}))}return e}({},r.default));o(f).$mount(),a.default.prototype.painter=n("be91")}).call(this,n("bc2e")["default"],n("543d")["createApp"])}},[["f87f","common/runtime","common/vendor"]]]);